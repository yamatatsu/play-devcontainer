# DevContainer

## 選定理由

### 主な目的

DevContainerは環境構築の課題解決のためではなく、**セキュリティ対策**を主目的として導入している。

1. **Claude Codeの安全な利用**
   - AI生成コードがホスト環境に与える影響を隔離
   - サプライチェーン攻撃と同様のリスクを想定し、被害範囲をコンテナ内に限定

2. **サプライチェーン攻撃からの防御**
   - npm packageの悪意あるコード実行によるホスト侵害を防止
   - 参考: [OSS の依存パッケージに起因するリスクを緩和する - blog.jxck.io](https://blog.jxck.io/entries/2025-09-20/mitigate-risk-of-oss-dependencies.html)

### 保護対象の資産

- SSH鍵
- 認証情報（特にSaaSのクレデンシャル）
- ホストのファイルシステム全体

### 技術選定の根拠

- **DevContainerはglobal standard**であり、広く採用されているベストプラクティス
- 代替案（Podman等）は特定の理由があれば検討可能だが、現時点ではDocker + DevContainerで十分

## 採用のトレードオフ

### 受け入れるコスト

DevContainerの導入・運用には以下のコストが発生するが、**セキュリティとのトレードオフとして受け入れるべき**と判断している。

1. **初期セットアップコスト**
   - コンテナイメージのビルド時間
   - DevContainer設定の学習コスト

2. **運用コスト**
   - ホスト開発と比較した追加の複雑性
   - パフォーマンス上の懸念（ファイルI/O等）は存在するが、現時点では許容範囲

3. **エディタの制約**
   - VS Code（またはJetBrains製品）前提の環境
   - **エディタの選択肢よりセキュリティを優先**

### メリット

- **ホスト環境の完全な保護**
  - 悪意あるコードの実行範囲をコンテナ内に限定
  - 侵害発生時の影響をコンテナ破棄・再作成で解決可能

- **最小権限の原則を適用しやすい**
  - 例: GitHub認証にFine-grained PATを利用し、アクセス可能なリポジトリを限定
  - DevContainer内のクレデンシャルを必要最小限に制限

- **モノレポ構成との親和性**
  - Agent coding（Claude Code等）を効率的に進めるために必要
  - Turborepo + PostgreSQL等のミドルウェアをDocker Composeで統合管理

## 環境構築の背景

Node.jsは多くの環境で素直に動作するため、**環境差異による問題は発生していない**。DevContainerはあくまでセキュリティ目的であり、環境統一のためではない。

## 今後の展開

- **CI/CD環境への展開**
  - 現在は開発環境のみだが、CI/CD環境でも同様にコンテナ分離を整備予定
  - 一貫したセキュリティモデルを構築

## 批判的考察

### 限界

- コンテナ分離はセキュリティの**一層**に過ぎず、完全な防御ではない
- コンテナエスケープのリスクは依然として存在
- パフォーマンス劣化がプロジェクト規模拡大時に顕在化する可能性

### 代替案の再検討が必要なケース

- パフォーマンスが許容範囲を超えた場合
- チーム規模拡大により、DevContainerの学習コストが障壁となる場合
- より強固な分離（VM利用等）が必要と判断された場合

### 前提条件

本選定は以下を前提としている：

- セキュリティを最優先事項とするプロジェクト方針
- コスト（時間・複雑性）よりもリスク低減を重視する判断
- AI支援開発ツール（Claude Code等）の継続利用

---

**結論**: DevContainerは環境構築ツールではなく、**セキュリティ対策の基盤**として採用している。導入コストは存在するが、サプライチェーン攻撃およびAI生成コードのリスクからホスト環境を保護するために不可欠である。
